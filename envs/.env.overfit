# =============================================================================
# Overfitting Test Configuration
# =============================================================================
# Use this configuration to verify training works by overfitting on a small
# subset of data. Expected: near 100% accuracy on training data.
# =============================================================================

# -----------------------------------------------------------------------------
# Experiment Settings
# -----------------------------------------------------------------------------
EXPERIMENT_NAME=overfit_test
OUTPUT_DIR=./outputs/overfit

# -----------------------------------------------------------------------------
# Model Configuration
# -----------------------------------------------------------------------------
MODEL_CHECKPOINT_PATH=./paligemma-3b-pt-224.f16.npz
MODEL_TOKENIZER_PATH=./paligemma_tokenizer.model
MODEL_KAGGLE_HANDLE=google/paligemma/jax/paligemma-3b-pt-224

# Model architecture
MODEL_LLM_VARIANT=gemma_2b
MODEL_VOCAB_SIZE=257152
MODEL_IMG_SIZE=224
MODEL_IMG_VARIANT=So400m/14
MODEL_IMG_POOL_TYPE=none
MODEL_IMG_SCAN=true
MODEL_IMG_DTYPE_MM=float16

# -----------------------------------------------------------------------------
# Training Configuration (Overfit settings)
# -----------------------------------------------------------------------------
TRAINABLE_PARAMS=attention_only

# Higher LR and more epochs for overfitting
LEARNING_RATE=0.05
BATCH_SIZE=4
NUM_EPOCHS=50
WARMUP_PERCENT=0.05
LR_SCHEDULE=constant
MAX_GRAD_NORM=1.0
SEED=42

# -----------------------------------------------------------------------------
# Data Configuration (Small subset)
# -----------------------------------------------------------------------------
DATA_BASE_DIR=/home/suchae/pi_workspace/XVR
DATA_TRAIN_FILE=train.jsonl
DATA_VALID_FILE=valid.jsonl
DATA_EVAL_FILE=xvr_eval.jsonl
DATA_IMAGE_DIR=images

# Use small subset for overfitting
MAX_TRAIN_SAMPLES=20
MAX_EVAL_SAMPLES=20

MAX_SEQ_LENGTH=256
SHUFFLE_BUFFER_SIZE=100
NUM_PARALLEL_CALLS=4

PROMPT_PREFIX=answer en

# -----------------------------------------------------------------------------
# Logging (Frequent for monitoring)
# -----------------------------------------------------------------------------
LOG_EVERY=1
EVAL_EVERY=50
CHECKPOINT_EVERY=100
MAX_CHECKPOINTS_TO_KEEP=2

USE_WANDB=false
WANDB_PROJECT=paligemma-overfit
WANDB_ENTITY=

# -----------------------------------------------------------------------------
# Evaluation
# -----------------------------------------------------------------------------
EVAL_NUM_EXAMPLES=20
EVAL_BATCH_SIZE=4
EVAL_SAMPLER=greedy
EVAL_NUM_BEAMS=4

# -----------------------------------------------------------------------------
# System Configuration
# -----------------------------------------------------------------------------
XLA_MEM_FRACTION=0.9
SHARDING_STRATEGY=fsdp
TF_ALLOW_GROWTH=true

BIG_VISION_PATH=/home/suchae/pi_workspace/big_vision
