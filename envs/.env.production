# =============================================================================
# Production Training Configuration
# =============================================================================
# Final production training with optimized hyperparameters.
# Use after validating with overfit test and long training experiments.
# =============================================================================

# -----------------------------------------------------------------------------
# Experiment Settings
# -----------------------------------------------------------------------------
EXPERIMENT_NAME=production
OUTPUT_DIR=./outputs/production

# -----------------------------------------------------------------------------
# Model Configuration
# -----------------------------------------------------------------------------
# MODEL_CHECKPOINT_PATH=./checkpoints/pi05_base_paligemma.npz
MODEL_TOKENIZER_PATH=./assets/paligemma_tokenizer.model
MODEL_KAGGLE_HANDLE=google/paligemma/jax/paligemma-3b-pt-224

# Model architecture
MODEL_LLM_VARIANT=gemma_2b
MODEL_VOCAB_SIZE=257152
MODEL_IMG_SIZE=224
MODEL_IMG_VARIANT=So400m/14
MODEL_IMG_POOL_TYPE=none
MODEL_IMG_SCAN=true
MODEL_IMG_DTYPE_MM=float16

# -----------------------------------------------------------------------------
# Training Configuration (Optimized)
# -----------------------------------------------------------------------------
TRAINABLE_PARAMS=attention_only

# Tuned hyperparameters (adjust based on validation experiments)
LEARNING_RATE=2e-4
BATCH_SIZE=8
NUM_EPOCHS=2
WARMUP_PERCENT=0.10
LR_SCHEDULE=cosine
MAX_GRAD_NORM=1.0
SEED=42

# -----------------------------------------------------------------------------
# Data Configuration (Full dataset)
# -----------------------------------------------------------------------------
DATA_BASE_DIR=/workspace/paligemma_jax_training/../XVR
DATA_TRAIN_FILE=train.jsonl
DATA_VALID_FILE=valid.jsonl
# DATA_EVAL_FILE=xvr_eval.jsonl  # Test set - only used by evaluate.py --split eval
DATA_IMAGE_DIR=images

# Full dataset
MAX_TRAIN_SAMPLES=
MAX_EVAL_SAMPLES=

MAX_SEQ_LENGTH=512
SHUFFLE_BUFFER_SIZE=1000

PROMPT_PREFIX=answer en

# -----------------------------------------------------------------------------
# Logging (Reduced frequency for production)
# -----------------------------------------------------------------------------
LOG_EVERY=50
EVAL_EVERY=500
CHECKPOINT_EVERY=5000
MAX_CHECKPOINTS_TO_KEEP=3

# W&B for production tracking
USE_WANDB=true
WANDB_PROJECT=paligemma-xvr-production
WANDB_ENTITY=

# -----------------------------------------------------------------------------
# Evaluation (Full validation set)
# -----------------------------------------------------------------------------
EVAL_NUM_EXAMPLES=
EVAL_BATCH_SIZE=4
EVAL_SAMPLER=greedy

# -----------------------------------------------------------------------------
# System Configuration
# -----------------------------------------------------------------------------
XLA_MEM_FRACTION=0.9
TF_ALLOW_GROWTH=true

BIG_VISION_PATH=/workspace/paligemma_jax_training/../big_vision
